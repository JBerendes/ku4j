//kodmunki utilities
(function(aJ){if(!aJ){aJ={}}aJ.ku.equations={cycle:function(a1,a3,a2,a0,aZ){return new aJ.coord(this.sin(a1.x,a3,a2),this.cos(a1.y,a0,aZ))},cos:function(a1,a0,aZ){return a1+Math.cos(a0)*aZ},cosH:function(a1,a0,aZ){return new aJ.coord(this.cos(a1.x,a0,aZ),a1.y)},cosV:function(a1,a0,aZ){return new aJ.coord(a1.x,this.cos(a1.y,a0,aZ))},sin:function(a1,a0,aZ){return a1+Math.sin(a0)*aZ},sinH:function(a1,a0,aZ){return new aJ.coord(this.sin(a1.x,a0,aZ),a1.y)},sinV:function(a1,a0,aZ){return new aJ.coord(a1.x,this.sin(a1.y,a0,aZ))}};aJ.anime={algorithms:{ease:{}}};var aT=function(aZ){this._ease=aZ||0.1};aT.prototype={calculate:function(a0,aZ){return(aZ-a0)*this._ease}};aJ.anime.algorithms.ease.linear=function(aZ){return new aT(aZ)};var aL=function(){};aL.prototype={calculate:function(a0,aZ){return aZ-a0}};aJ.anime.algorithms.jump=function(){return new aL()};var o=function(a0,aZ){this._spring=a0||0.4;this._mu=aZ||0.6};o.prototype={calculate:function(a5,a1,a4){var a0=this._spring,a2=a4,aZ=this._mu,a6=a1-a5,a3=a6*a0;a2+=a3;a2*=aZ;return a2}};aJ.anime.algorithms.spring=function(a0,aZ){return new o(a0,aZ)};function aW(aZ){this._context=aZ}aW.prototype={findCoord:function(a1){var aZ=this._context,a0=aJ.touch().canRead(a1)?aJ.touch():aJ.mouse();return a0.documentCoord(a1).subtract(aZ.hitCoord()).subtract(aZ.hitOffset()).add(aZ.hitBoundedOffet())}};function y(aZ){this._context=aZ}y.prototype={findCoord:function(a1){var aZ=this._context,a0=aJ.touch().canRead(a1)?aJ.touch():aJ.mouse();return aZ.hitSize().add(a0.documentCoord(a1).subtract(aZ.hitCoord()).subtract(aZ.hitOffset()))}};function aH(aZ){this._context=aZ}aH.prototype={findCoord:function(a1){var aZ=this._context,a0=aJ.touch().canRead(a1)?aJ.touch():aJ.mouse();return aZ.hitCoord().add(aZ.hitOffset()).subtract(a0.documentCoord(a1)).add(aZ.hitScrollOffset())}};var aw={};function ai(aZ){ai.base.call(this,aZ);this._mouseEvt=aJ.uid("dragger");this._touchEvt=aJ.uid("toucher");this._documentBody=aJ.dom(document.body);this._onGrab=aJ.observer();this._onDrag=aJ.observer();this._onDrop=aJ.observer();this._constrainX=false;this._constrainY=false;this._boundX=0;this._boundY=0;this._lastPoint=aJ.coord.zero();this._bearing=aJ.vector.zero();this._document=aJ.dom(document);this.state(new aw.dropped()).dragger().dragOffset(aJ.coord.zero()).ontouchstart(this.grab,this,this._touchEvt).onmousedown(this.grab,this,this._mouseEvt)}ai.prototype={document:function(){return this._document},hitSize:function(aZ){return this.property("hitSize",aZ)},hitCoord:function(aZ){return this.property("hitCoord",aZ)},hitOffset:function(aZ){return this.property("hitOffset",aZ)},dragOffset:function(aZ){return this.property("dragOffset",aZ)},hitScrollOffset:function(aZ){return this.property("hitScrollOffset",aZ)},hitBoundedOffet:function(aZ){return this.property("hitBoundedOffet",aZ)},actor:function(){return this.get("actor")},strategy:function(){return this.get("strategy")},bearing:function(){return this.get("bearing")},bearingUp:function(){return this.bearing().y()<0},bearingDown:function(){return this.bearing().y()>0},bearingLeft:function(){return this.bearing().x()<0},bearingRight:function(){return this.bearing().x()>0},constrainX:function(){if(this._constrainX){return this}this._constrainX=true;this._boundX=this.boundedOffset().x();return this},unconstrainX:function(){this._constrainX=false},constrainY:function(){if(this._constrainY){return this}this._constrainY=true;this._boundY=this.boundedOffset().y();return this},unconstrainY:function(){this._constrainY=false},state:function(aZ){return this.set("state",aZ.context(this))},dragCoord:function(a1){var a4=this.strategy().findCoord(a1),a0=this.dragOffset(),aZ=(this._constrainX)?this._boundX:a4.x()+a0.x(),a3=(this._constrainY)?this._boundY:a4.y()+a0.y(),a2=aJ.coord(aZ,a3);this._bearing=a2.distanceFrom(this._lastPoint);this._lastPoint=a2;return a2},dragger:function(){return this.set("actor",aJ.pinner(this.dom())).set("strategy",new aW(this))._setType("dragger")},sizer:function(){return this.set("actor",aJ.sizer(this.dom())).set("strategy",new y(this))._setType("sizer")},scroller:function(){return this.set("actor",aJ.scroller(this.dom())).set("strategy",new aH(this))._setType("scroller")},grab:function(aZ){this._onGrab.notify(aZ);this._state.grab(aZ);return this},drag:function(aZ){this._onDrag.notify(aZ);this._state.drag(aZ);return this},drop:function(aZ){this._onDrop.notify(aZ);this._state.drop(aZ);this._bearing=aJ.vector.zero();return this},onGrab:function(a0,aZ,a1){this._onGrab.add(a0,aZ,a1);return this},onDrag:function(a0,aZ,a1){this._onDrag.add(a0,aZ,a1);return this},onDrop:function(a0,aZ,a1){this._onDrop.add(a0,aZ,a1);return this},destroy:function(){this._onGrab.clear();this._onDrag.clear();this._onDrop.clear();this.removeEvent(this._mouseEvt).removeEvent(this._touchEvt)},disableSelect:function(a0){document.onselectstart=function(){return false};if(!aJ.exists(window.getSelection)){return this}this._mouseDisableId=aJ.uid("disable");this._touchDisableId=aJ.uid("disable");function aZ(){window.getSelection().removeAllRanges()}this._documentBody.onmousemove(aZ,null,this._mouseDisableId).ontouchmove(aZ,null,this._touchDisableId);return this},enableSelect:function(){document.onselectstart=null;var aZ=this._mouseDisableId,a0=this._touchDisableId,a1=this._documentBody;if(aJ.exists(aZ)){a1.removeEvent(aZ)}if(aJ.exists(a0)){a1.removeEvent(a0)}this._mouseDisableId=null;this._touchDisableId=null;return this},_setType:function(aZ){this._clearType().addClass(aJ.str.format("ku-dragger-{0}",aZ));return this},_clearType:function(){this.removeClass("ku-dragger-dragger").removeClass("ku-dragger-sizer").removeClass("ku-dragger-scoller");return this}};aJ.ext(ai,aJ.dom.Class);aJ.dnd=function(aZ){return new ai(aZ)};aw.dropped=function(){aw.dropped.base.call(this,aw)};aw.dropped.prototype={grab:function(a2){aJ.evt.mute(a2);var aZ=this.context(),a1=aJ.touch().canRead(a2)?aJ.touch():aJ.mouse(),a0=a1.documentCoord(a2).subtract(aZ.offset());aZ.document().ontouchmove(aZ.drag,aZ,aJ.uid()).ontouchend(aZ.drop,aZ,aJ.uid()).onmousemove(aZ.drag,aZ,aJ.uid()).onmouseup(aZ.drop,aZ,aJ.uid());aZ.disableSelect().addClass("ku-dragger-grabbed").hitSize(aZ.outerDims()).hitCoord(a0).hitOffset(aZ.offset()).hitScrollOffset(aZ.scrollOffset()).hitBoundedOffet(aZ.boundedOffset()).actor().to(aZ.dragCoord(a2));this.state("grabbed")},drag:function(){return},drop:function(){return}};aJ.ext(aw.dropped,aJ.abstractState);aw.grabbed=function(){aw.grabbed.base.call(this,aw)};aw.grabbed.prototype={grab:function(){return},drag:function(a0){aJ.evt.mute(a0);var aZ=this.context();aZ.actor().to(aZ.dragCoord(a0));this.context().redraw()},drop:function(aZ){this.context().enableSelect().removeClass("ku-dragger-grabbed").document().clearEvents();this.state("dropped")}};aJ.ext(aw.grabbed,aJ.abstractState);function f(aZ){f.base.call(this,aZ);this._onEnd=aJ.observer();this.linear()}f.prototype={$to:function(aZ){return},$moveTo:function(aZ){return},$done:function(){this._onEnd.notify();return this},algorithm:function(aZ){this.$algorithm=aZ;return this},linear:function(aZ){return this.algorithm(aJ.anime.algorithms.ease.linear(aZ))},spring:function(a0,aZ){this.algorithm(aJ.anime.algorithms.spring(a0,aZ))},stop:function(){if(!aJ.exists(this.$tween)){return this}this.$tween.stop();return this},to:function(aZ){this.stop().$to(aZ).$done();return this},moveTo:function(aZ){this.stop().$moveTo(aZ);return this},onEnd:function(a0,aZ){if(!aJ.exists(a0)){return this}this._onEnd.add(a0,aZ);return this}};aJ.ext(f,aJ.dom.Class);function x(aZ){aJ.dom(aZ).addClass("ku-fader");x.base.call(this,aZ)}x.prototype={$to:function(aZ){var a1=this.dom(),a0=aJ.dom(a1);a0.style("opacity",aZ*0.01);return this},$moveTo:function(aZ){var a1=this.dom(),a0=aJ.dom(a1),a2=a0.style("opacity")||1;this.$tween=aJ.tween(function(a3){a0.style("opacity",a3*0.01)},a2,aZ,this.$algorithm).onEnd(this.$done,this).start(a1)}};aJ.ext(x,f);aJ.fader=function(aZ){return new x(aZ)};function af(aZ){aJ.dom(aZ).addClass("ku-fitter");af.base.call(this,aZ)}af.prototype={$to:function(aZ){var a1=this.dom(),a0=aJ.dom(a1);a0.style("width",aZ.x()+"px");a0.style("height",aZ.y()+"px");return this},$moveTo:function(a2){var a0=this.dom(),aZ=aJ.dom(a0),a1=aZ.outerDims();this.$tween=aJ.tween(function(a3){aZ.style("width",a3.x()+"px");aZ.style("height",a3.y()+"px")},a1,ar(this,a2),this.$algorithm).onEnd(this.$done,this).start(a0)}};aJ.ext(af,f);function ar(aZ,a1){var a2=a1.y()/a1.x(),a0=aJ.dom(aZ.dom()),a6=a0.outerDims(),a3=a6.y()/a6.x(),a7=isNaN(a3)?1:a3,a5=a6.x(),a4=a6.y();if((a7<a2)||(a7==a2)){a5=a1.x();a4=a1.x()*a3}if(a7>a2){a5=a1.y()/a3;a4=a1.y()}return aJ.coord(a5,a4)}aJ.fitter=function(aZ){return new af(aZ)};function k(aZ){aJ.dom(aZ).addClass("ku-pinner");k.base.call(this,aZ)}k.prototype={$to:function(aZ){var a1=this.dom(),a0=aJ.dom(a1);a0.style("left",aZ.x()+"px");a0.style("top",aZ.y()+"px");return this},$moveTo:function(a5){var a3=this.dom(),a2=aJ.dom(a3),a1=a2.offset(),a0=aJ.findOffset(a3.parentNode),aZ=(aJ.coord.canParse(a0))?aJ.coord.parse(a0):aJ.coord.zero(),a4=a1.subtract(aZ);this.$tween=aJ.tween(function(a6){a2.style("left",a6.x()+"px");a2.style("top",a6.y()+"px")},a4,a5,this.$algorithm).onEnd(this.$done,this).start(a3)}};aJ.ext(k,f);aJ.pinner=function(aZ){return new k(aZ)};function R(aZ){aJ.dom(aZ).addClass("ku-scoller");R.base.call(this,aZ)}R.prototype={$to:function(aZ){var a1=this.dom(),a0=aJ.dom(a1);a0.style("scrollLeft",aZ.x());a0.style("scrollTop",aZ.y());return this},$moveTo:function(a5){var a3=this.dom(),a2=aJ.dom(a3),a1=a2.scrollOffset(),a0=aJ.findOffset(a3.parentNode),aZ=(aJ.coord.canParse(a0))?aJ.coord.parse(a0):aJ.coord.zero(),a4=a1.subtract(aZ);this.$tween=aJ.tween(function(a6){a2.style("scrollLeft",a6.x());a2.style("scrollTop",a6.y())},a4,a5,this.$algorithm).onEnd(this.$done,this).start(a3)}};aJ.ext(R,f);aJ.scroller=function(aZ){return new R(aZ)};function G(aZ){aJ.dom(aZ).addClass("ku-sizer");G.base.call(this,aZ)}G.prototype={$to:function(aZ){var a1=this.dom(),a0=aJ.dom(a1);a0.style("width",aZ.x()+"px");a0.style("height",aZ.y()+"px");return this},$moveTo:function(a2){var a0=this.dom(),aZ=aJ.dom(a0),a1=aZ.outerDims();this.$tween=aJ.tween(function(a3){aZ.style("width",a3.x()+"px");aZ.style("height",a3.y()+"px")},a1,a2,this.$algorithm).onEnd(this.$done,this).start(a0)}};aJ.ext(G,f);aJ.sizer=function(a1,a0,aZ){return new G(a1,a0,aZ)};function aO(aZ,a0){aJ.dom(aZ).addClass("ku-styler");aO.base.call(this,aZ);this._prop=a0}aO.prototype={$moveTo:function(a1){var a5=this.dom(),a4=aJ.dom(a5),a2=this._prop,a3=a4.style(a2),aZ=aJ.ku.style,a0=aZ.getUnit(a3)||"",a6=aZ.toNumber(a3);this.$tween=aJ.tween(function(a7){a4.style(a2,a7+a0)},a6,a1,this.$algorithm).onEnd(this.$done,this).start(a5)}};aJ.ext(aO,f);aJ.styler=function(aZ,a0){return new aO(aZ,a0)};function aa(a0,aZ){aa.base.call(this,aZ);this._listeners=aJ.observer();this._ticks=0;this.fps(a0||30)}aa.prototype={fps:function(aZ){this._interval=1000/aZ;return this.property("fps",aZ)},interval:function(){return this.get("interval")},listeners:function(){return this.get("listeners")},ticks:function(){return this.get("ticks")},start:function(){this._state.start();return this},stop:function(){this._state.stop();return this},add:function(a0,a7,aZ,a1){var a4=this,a6=a1||1,a5=aZ||aJ.uid("timeline"),a3=function(){if(!a4._ticks%a6==0){return}a0();a2=a0},a2=(!a1)?a0:a3;this._listeners.add(a2,a7,a5);return this},remove:function(aZ){this._listeners.remove(aZ);return this},clear:function(){this._listeners.clear();return this},tick:function(){this._ticks++;return this}};aJ.ext(aa,aJ.abstractContext);aJ.timeline=function(){return I};aa.started=function(){aa.started.base.call(this,aa)};aa.started.prototype={start:function(){return},stop:function(){clearTimeout(ku_timeline);ku_timeline=null;this.state("stopped")}};aJ.ext(aa.started,aJ.abstractState);aa.stopped=function(){aa.stopped.base.call(this,aa)};aa.stopped.prototype={start:function(){var a1=this.context(),a0=a1.interval(),aZ=function(){a1.tick().listeners().notify();ku_timeline=setTimeout(aZ,a0)};aZ();this.state("started")},stop:function(){return}};aJ.ext(aa.stopped,aJ.abstractState);var I=new aa(30,new aa.stopped()).start();var ah=function(a2,a1,aZ,a0){this.$method=a2;this.$current=a1;this.$end=aZ;this.$algorithm=a0;this.$value=0;this._onEnd=aJ.observer();this._id=aJ.uid("tween")};ah.prototype={$exec:function(){return},$done:function(){this._onEnd.notify()},start:function(){aJ.timeline().add(this.$exec,this,this._id);return this},stop:function(){aJ.timeline().remove(this._id);return this},onEnd:function(a0,aZ){this._onEnd.add(a0,aZ);return this},clear:function(){this._onEnd.clear();return this}};aJ.ext(ah,aJ.Class);var aj=function(a2,a1,aZ,a0){aj.base.call(this,a2,a1,aZ,a0);this.$value=aJ.coord.zero()};aj.prototype={$exec:function(){var a5=this.$method,a4=this.$current,aZ=this.$end;var a2=this.$algorithm.calculate(a4.x(),aZ.x(),this.$value.x());var a0=this.$algorithm.calculate(a4.y(),aZ.y(),this.$value.y()),a1=aJ.coord(a2,a0),a3=aZ.abs().subtract(a4.abs());if((Math.abs(a2)<0.1)&&(a3.x()<1)&&(Math.abs(a0)<0.1)&&(a3.y()<1)){a5(aZ);this.stop()._onEnd.notify();return}this.$current=a4.add(a1);this.$value=a1;a5(this.$current)}};aJ.ext(aj,ah);var a=function(a2,a1,aZ,a0){a.base.call(this,a2,a1,aZ,a0)};a.prototype={$exec:function(){var a2=this.$method,a1=this.$current,aZ=this.$end,a0=this.$algorithm.calculate(a1,aZ,this.$value);if((Math.abs(a0)<0.1)&&(Math.abs(aZ-a1)<1)){a2(aZ);this.stop().$done();return}this.$current=a1+a0;this.$value=a0;a2(this.$current)}};aJ.ext(a,ah);aJ.tween=function(a2,a1,aZ,a0){return(aJ.isNumber(a1)&&aJ.isNumber(aZ))?new a(a2,a1,aZ,a0):new aj(a2,a1,aZ,a0)};function Q(a3,a2,aZ,a0,a4,a1){Q.base.call(this,a3);this.id(aJ.uid("jsx-cell")).cIdx(a2).cKey(aZ).rIdx(a0).rKey(a4).value(a1)}Q.prototype={id:function(aZ){return this.property("id",aZ)},value:function(aZ){return this.property("value",aZ)},cIdx:function(aZ){if(aJ.exists(aZ)){this.dom().cIdx=aZ}return this.property("cIdx",aZ)},rIdx:function(aZ){if(aJ.exists(aZ)){this.dom().rIdx=aZ}return this.property("rIdx",aZ)},cKey:function(aZ){if(aJ.exists(aZ)){this.dom().cKey=aZ}return this.property("cKey",aZ)},rKey:function(aZ){if(aJ.exists(aZ)){this.dom().rKey=aZ}return this.property("rKey",aZ)}};aJ.ext(Q,aJ.dom.Class);aJ.cell=function(a3,a2,aZ,a0,a4,a1){return new Q(a3,a2,aZ,a0,a4,a1)};aJ.cell.Class=Q;function V(a3,a0,aZ,a1,a2){V.base.call(this,a3);this.id(aJ.uid()).col(a0).index(aZ).key(a1).value(a2);this._cells=aJ.hash()}V.prototype={id:function(aZ){return this.property("id",aZ)},col:function(aZ){return this.property("col",aZ)},value:function(aZ){if(aJ.exists(aZ)){this.content(aZ)}return this.property("value",aZ)},index:function(aZ){if(aJ.exists(aZ)){this.dom().cIdx=aZ}return this.property("index",aZ)},key:function(aZ){if(aJ.exists(aZ)){this.dom().cKey=aZ}return this.property("key",aZ)},findCell:function(aZ){return this._cells.find(aZ)},listCells:function(){return this._cells.listValues()},addCell:function(aZ){this._cells.add(aZ.rKey(),aZ);return this},removeCell:function(aZ){var a0=this._cells;a0.remove(aZ.rKey());if(a0.isEmpty()){aJ.dom(this._col).detach();this.detach()}return this},};aJ.ext(V,aJ.dom.Class);aJ.column=function(a3,a0,aZ,a1,a2){return new V(a3,a0,aZ,a1,a2)};aJ.column.Class=V;function al(a0){aJ.cast(this,a0);this._dri=new aJ.iterator(this.rows.listValues());this.helper=aJ.create({tr:{"class":"ku-table-dragRow-helper"}});aJ.slider(this.helper,null,null,null,null,null,"dragger","vertical");this._isMoving=false;this._hitPoint;this._moveDom;function aZ(a1){return aJ.cast(aJ.coord.parse(aJ.findOffset(this.dom)),aJ.point)}this._dri.foreach(function(a1){aJ.evt.add(a1.dom,"mouseover",function(){if(!this._isMoving){return}var a6=a1.dom,a2=this.body,a3=this.helper,a4=this._hitPoint,a5=aZ(a6);if(!a6.nextSibling){a2.appendChild(a3)}else{if(a5.isAbove(a4)){a2.insertBefore(a3,a6)}else{a2.insertBefore(a3,a6.nextSibling)}}this._hitPoint=a5},this);aJ.dnd(a1.dom,function(){this.helper=a1.dom;this._isMoving=true;this._hitPoint=aZ(a1.dom);this._moveDom=a1.dom;this.body.insertBefore(this.helper,a1.dom);aJ.ku.css.addClass(this.body,"ku-table-draggableRow-dragging");aJ.ku.css.addClass(this._moveDom,"ku-table-draggableRow-moveDom")},null,function(){aJ.ku.css.removeClass(this.body,"ku-table-draggableRow-dragging");aJ.ku.css.removeClass(this._moveDom,"ku-table-draggableRow-moveDom");aJ.ku.swapDom(this.helper,this._moveDom);this._isMoving=false;this._moveDom=null;this.format()},this)},this)}aJ.draggableRowDecorator=function(aZ){return new al(aZ)};function aD(aZ){aJ.cast(this,aZ);this._sci=new aJ.iterator(this.columns.listValues());this._sci.foreach(function(a2){var a1=a2.dom,a0=aJ.create({a:{"class":"ku-table-col-sizer"}});new aJ.slider(a1,a0,null,null,null,null,"sizer","horizontal");a1.appendChild(a0)})}function aG(aZ){aJ.cast(this,aZ);this._isAsc=false;this._asc=new aJ.sorter(sorter.strategy.asc);this._des=new aJ.sorter(sorter.strategy.des);this._sortci=new aJ.iterator(this.columns.listValues());this._sortci.foreach(function(a2){var a0=new aJ.iterator(a2.cells.listValues()),a1=aJ.create({a:{"class":"ku-table-col-sorter"}});a2.dom.appendChild(a1);aJ.evt.add(a1,"click",function(){var bb=[],a3=this._isAsc,bc=(a3)?this._asc:this._des,a5="ku-table-col-sorter-{0}",a8=aJ.str.format(a5,"asc"),a6=aJ.str.format(a5,"dec"),ba=(a3)?a8:a6;a0.foreach(function(bd){bb[bb.length]=bd.dom});this._isAsc=!this._isAsc;var a9=bc.sort(bb),a4=a9.length,a7=this.body;aJ.clearNode(a7);while(a4--){a7.appendChild(this.rows.find(a9[i].rIdx).dom)}aJ.ku.css.removeClass(a1,a8);aJ.ku.css.removeClass(a1,a6);aJ.ku.css.addClass(a1,ba);this.format()},this)},this)}function T(){T.base.call(this)}T.prototype={table:function(aZ){return this.set("table",aZ)},createColumn:function(a0,a1,a2){var aZ=aJ.create({col:{}}),a3=aJ.create({th:{"ku-key":a1},content:aJ.create({span:{"class":"ku-table-head-content"},content:a2})});return aJ.column(a3,aZ,a0,a1,a2)},createRow:function(aZ,a0){var a1=aJ.create({tr:{"class":"ku-table-row"}});return aJ.row(a1,aZ,a0)},createCell:function(a4,a3,a0,a2,a6){var a1=this._table,a5=aJ.create({td:{"class":"ku-table-cell"},content:a4}),aZ=aJ.cell(a5,a3,a0,a2,a6,a4).onclick(function(){a1.selectCell(aZ)},this);return aZ}};aJ.ext(T,aJ.Class);function aE(a1,aZ,a0){aE.base.call(this,a1);this.id(aJ.uid()).index(aZ).key(a0);this._cells=aJ.hash()}aE.prototype={id:function(aZ){return this.property("id",aZ)},index:function(aZ){if(aJ.exists(aZ)){this.dom().rIdx=aZ}return this.property("index",aZ)},key:function(aZ){if(aJ.exists(aZ)){this.dom().rKey=aZ}return this.property("key",aZ)},findCell:function(aZ){return this._cells.find(aZ)},listCells:function(){return this._cells.listValues()},addCell:function(aZ){this._dom.appendChild(aZ.dom());this._cells.add(aZ.cKey(),aZ);return this},removeCell:function(aZ){this._dom.removeChild(aZ.dom());this._cells.remove(aZ.cKey());return this}};aJ.ext(aE,aJ.dom.Class);aJ.row=function(a2,aZ,a0,a1){return new aE(a2,aZ,a0,a1)};aJ.row.Class=aE;function ak(a2){var a6=aJ.create({table:{"class":"ku-table",cellspacing:0}});ak.base.call(this,a6);var a1=aJ.create({colgroup:{"class":"ku-table-colgroup"}}),a0=aJ.create({caption:{"class":"ku-table-caption"}}),a4=aJ.create({thead:{"class":"ku-table-head"}}),a5=aJ.create({tr:{"class":"ku-table-head-row"}}),aZ=aJ.create({tbody:{"class":"ku-table-body"}}),a3=aJ.create({tfoot:{"class":"ku-table-foot"}});this._columns=new aJ.hash();this._rows=new aJ.hash();this._cells=new aJ.hash();this._onCellSelect=aJ.observer();this.appendChild(a1).colgroup(a1).appendChild(a0).caption(a0).appendChild(a4).head(a4).appendChild(a5).headRow(a5).appendChild(aZ).body(aZ).appendChild(a3).foot(a3).factory(a2||new T()).head().appendChild(this.headRow())}ak.prototype={title:function(aZ){if(aJ.isString(aZ)){this.caption().innerHTML=aZ}else{if(aJ.exists(aZ)){this.caption().appendChild(aZ)}}return this.property("title",aZ)},factory:function(aZ){return this.property("factory",aZ.table(this))},caption:function(aZ){return this.property("caption",aZ)},colgroup:function(aZ){return this.property("colgroup",aZ)},head:function(aZ){return this.property("head",aZ)},headRow:function(aZ){return this.property("headRow",aZ)},body:function(aZ){return this.property("body",aZ)},foot:function(aZ){return this.property("foot",aZ)},listColumns:function(){return this._columns.listValues()},listRows:function(){return this._rows.listValues()},listCells:function(){return this._cells.listValues()},selectCell:function(aZ){this._onCellSelect.notify(aZ);return this},onCellSelect:function(a0,aZ){this._onCellSelect.add(a0,aZ);return this},addColumn:function(a0,a3,a2){var aZ=this._columns,a1=this._rows;if(aZ.containsKey(a0)){return this._updateColumn(a0,a3,a2)}else{return this._addColumn(a0,a3,a2)}},_addColumn:function(aZ,a2,a1){var a0=this._factory.createColumn(aJ.uid(),aZ,a1);this._columns.add(a0.key(),a0);this._rows.listValues().each(function(a3){this.addCell(a3,a0,a2[a3.key()])},this);this._colgroup.appendChild(a0.col());this._headRow.appendChild(a0.dom());return this},_updateColumn:function(aZ,a2,a1){var a0=this._columns.find(aZ);this._rows.listValues().each(function(a3){this.findCell(a3.key(),a0.key()).value(a2[a3.key()])},this);if(aJ.exists(a1)){a0.value(a1)}return this},findColumn:function(aZ){return this._columns.find(aZ)},removeColumn:function(aZ){var a1=this._rows,a0=this.findColumn(aZ);if(!aJ.exists(a0)){return this}a1.listValues().each(function(a2){this.removeCell(a0.findCell(a2.key()))},this);this._columns.remove(a0.key());return this},addRow:function(a0,a2){var a1=this._rows,aZ=this._columns;if(a1.containsKey(a0)){return this._updateRow(a0,a2)}else{return this._addRow(a0,a2)}},_addRow:function(aZ,a0){var a1=this._factory.createRow(aJ.uid(),aZ);this._rows.add(a1.key(),a1);this._columns.listValues().each(function(a2){this.addCell(a1,a2,a0[a2.key()])},this);this.body().appendChild(a1.dom());return this},_updateRow:function(aZ,a0){var a1=this._rows.find(aZ);this._columns.listValues().each(function(a2){this.findCell(a1.key(),a2.key()).value(a0[a2.key()])},this);return this},findRow:function(aZ){return this._rows.find(aZ)},removeRow:function(a0){var aZ=this._columns,a1=this.findRow(a0);if(!aJ.exists(a1)){return this}aZ.listValues().each(function(a2){this.removeCell(a1.findCell(a2.key()))},this);this._rows.remove(a1.key());return this},addCell:function(a2,a0,a1){var aZ=this._factory.createCell(a1,a0.index(),a0.key(),a2.index(),a2.key());a0.addCell(aZ);a2.addCell(aZ);this._cells.add(aZ.id(),aZ);return this},findCellById:function(aZ){return this._cells.find(aZ)},findCell:function(a2,a0){var aZ=this._cells.listValues(),a1;aZ.each(function(a3){if((a3.rKey()==a2)&&(a3.cKey()==a0)){a1=a3;aZ.quit()}});return a1},removeCell:function(aZ){this._cells.remove(aZ.id());this._columns.find(aZ.cKey()).removeCell(aZ);this._rows.find(aZ.rKey()).removeCell(aZ);return this},format:function(){var aZ=0,a0="ku-table-row-even",a1="ku-table-row-odd",a2=function(){(aZ%2==0)?a0:a1};this._rows.each(function(a3){a3.removeClass(a0).removeClass(a1).addClass(a2());aZ++})},toObject:function(){return{title:this.title(),columns:this._columns.toObject(),rows:this._rows.toObject()}}};aJ.ext(ak,aJ.dom.Class);aJ.table=function(aZ){return new ak(aZ)};aJ.table.Class=ak;ak.parseDom=function(a4){var a0=function(a7,a6){return a7.getElementsByTagName(a6)};ak=aJ.ele(a4),cols=a0(a0((a0(ak,"thead")[0]),"tr")[0],"th"),rows=a0((a0(ak,"tbody")[0]),"tr"),caption=a0(ak,"caption")[0],title=(!caption)?"":caption.innerHTML,t=new aJ.table(title),l=cols.length,m=rows.length,c=[];while(i--){var a3=cols[i],aZ=aJ.ku.getText(a3)||aJ.uid("table-column");c[c.length]=aZ;t.addColumn(aZ,a3.innerHTML)}while(m--){var a1=a0(rows[j],"td"),a5=a1.length,a2={};while(a5--){a2[c[aZ]]=a1[aZ].innerHTML}t.addRow(a2)}return t};ak.parseObject=function(a1){var aZ=new aJ.table(a1.title),a3=a1.columns,a0=a1.rows;for(var a2 in a3){aZ.addColumn(a2,a3[a2])}for(var a2 in a0){aZ.addRow(a0[a2])}return aZ};var u=function(){u.base.call(this,aJ.create({div:{"class":"ku-calendar"}}));var aZ=aJ.create({div:{"class":"ku-sheet"}});this._sheetContainer=aJ.dom(aZ);this._onShowDates=aJ.observer();this._onShowMonths=aJ.observer();this._onShowYears=aJ.observer();this._onSelect=aJ.observer();this._sheet;this.dayPoint(aJ.dayPoint.today()).localization(aJ.ku.localization.en).sheetFactory(aJ.clickableSheetFactory()).dom().appendChild(aZ)};u.prototype={dayPoint:function(aZ){return this.property("dayPoint",aZ)},localization:function(aZ){return this.property("localization",aZ)},sheetFactory:function(aZ){return this.set("sheetFactory",aZ)},isShowingDates:function(){return this._isShowingDates},isShowingMonths:function(){return this._isShowingMonths},isShowingYears:function(){return this._isShowingYears},nextDay:function(){this.dayPoint(this.dayPoint().nextDay());return this},prevDay:function(){this.dayPoint(this.dayPoint().prevDay());return this},nextMonth:function(){this.dayPoint(this.dayPoint().nextMonth());return this},prevMonth:function(){this.dayPoint(this.dayPoint().prevMonth());return this},nextYear:function(){this.dayPoint(this.dayPoint().nextYear());return this},prevYear:function(){this.dayPoint(this.dayPoint().prevYear());return this},showDates:function(){return this._showSheet("createDatesheet")._currentView(false,false,true)},showMonths:function(){return this._showSheet("createMonthsheet")._currentView(false,true,false)},showYears:function(){return this._showSheet("createYearsheet")._currentView(true,false,false)},findCell:function(aZ){return this._sheet.findCell(aZ)},each:function(a0,aZ){this._sheet.each(a0,aZ);return this},select:function(aZ){this._sheet.select(aZ);return this},onSelect:function(a0,aZ){this._onSelect.add(a0,aZ);return this},onShowDates:function(a0,aZ){this._onShowDates.add(a0,aZ);return this},onShowMonths:function(a0,aZ){this._onShowMonths.add(a0,aZ);return this},onShowYears:function(a0,aZ){this._onShowYears.add(a0,aZ);return this},_currentView:function(a0,aZ,a1){this._isShowingYears=a0;this._isShowingMonths=aZ;this._isShowingDates=a1;if(a0){this._onShowYears.notify()}if(aZ){this._onShowYears.notify()}if(a1){this._onShowDates.notify()}return this},_showSheet:function(a1){var aZ=this._sheet;if(aJ.exists(aZ)){aZ.destroy()}var a0=this._sheetFactory[a1](this.dayPoint(),this._localization).onSelect(this._onSelect.notify,this._onSelect);this._sheetContainer.clear().appendChild(a0.dom());this._sheet=a0;return this}};aJ.ext(u,aJ.dom.Class);aJ.calendar=function(){return new u()};var aU=function(a2){aU.base.call(this,aJ.create({div:{"class":"ku-calendar-controls"}}));this._calendar=a2;var a4=aJ.dom(aJ.create({div:{"class":"ku-calendar-title"}})),a1=aJ.dom(aJ.create({button:{"class":"ku-calendar-month"}})).onclick(this.showMonths,this),a0=aJ.dom(aJ.create({button:{"class":"ku-calendar-year"}})).onclick(this.showYears,this,this),aZ=aJ.dom(aJ.create({button:{"class":"ku-calendar-prevButton"}})).onclick(function(){this._prevAction()},this),a3=aJ.dom(aJ.create({button:{"class":"ku-calendar-nextButton"}})).onclick(function(){this._nextAction()},this);aJ.dom(this.dom()).appendChild(a4.appendChild(a1.dom()).appendChild(a0.dom()).dom()).appendChild(aZ.dom()).appendChild(a3.dom()).appendChild(a2.dom());this._title=a4;this._month=a1;this._year=a0;this._prevButton=aZ;this._nextButton=a3;this._prevAction;this._nextAction;this.onSelect(this._displayDates,this)};aU.prototype={dayPoint:function(aZ){var a0=this._calendar;if(!aJ.exists(aZ)){return a0.dayPoint()}a0.dayPoint(aZ);return this},localization:function(a0){var aZ=this._calendar;if(!aJ.exists(a0)){return aZ.localization()}aZ.localization(a0);return this},sheetFactory:function(aZ){this._calendar.sheetFactory(aZ);return this},nextDay:function(){this._calendar.nextDay();return this},prevDay:function(){this._calendar.prevDay();return this},nextMonth:function(){this._calendar.nextMonth();return this},prevMonth:function(){this._calendar.prevMonth();return this},nextYear:function(){this._calendar.nextYear();return this},prevYear:function(){this._calendar.prevYear();return this},showDates:function(){var a1=this._calendar,aZ=a1.localization().month.name,a0=a1.dayPoint();a1.showDates();this._month.html(aZ[a0.month()]);this._year.html(a0.year());this._prevAction=this._prevMonth;this._nextAction=this._nextMonth;return this},showMonths:function(){this._calendar.showMonths();var aZ=function(){return};this._prevAction=aZ;this._nextAction=aZ;return this},showYears:function(){this._calendar.showYears();this._prevAction=this._prevYears;this._nextAction=this._nextYears;return this},findCell:function(aZ){return this._calendar.findCell(aZ)},each:function(a0,aZ){this._calendar.each(a0,aZ);return this},select:function(aZ){this._calendar.select(aZ);return this},onSelect:function(a0,aZ){this._calendar.onSelect(a0,aZ);return this},onShowDates:function(a0,aZ){this._calendar.onShowDates(a0,aZ);return this},onShowMonths:function(a0,aZ){this._calendar.onShowMonths(a0,aZ);return this},onShowYears:function(a0,aZ){this._calendar.onShowYears(a0,aZ);return this},_prevMonth:function(){this.prevMonth().showDates()},_nextMonth:function(){this.nextMonth().showDates()},_prevYears:function(){this.dayPoint(this.dayPoint().add(-12,0,0)).showYears()},_nextYears:function(){this.dayPoint(this.dayPoint().add(12,0,0)).showYears()},_displayDates:function(aZ){var a6=this._calendar,a0=a6.isShowingDates(),a5=a6.isShowingMonths(),a4=a6.isShowingYears(),a1=a6.dayPoint(),a2=aZ.value(),a3;if(a4){a3=aJ.dayPoint(a2.year(),a1.month(),a1.date())}if(a5){a3=aJ.dayPoint(a1.year(),a2.month(),a1.date())}if(a0){a3=a2}this.dayPoint(a3);if(a4||a5||(a1.month()!=a2.month())){this.showDates()}}};aJ.ext(aU,aJ.dom.Class);aJ.calendarControlsDecorator=function(aZ){return new aU(aZ)};function aY(){}aY.prototype={createDatesheet:function(aZ,a0){return aJ.datesheet(aZ,a0,aJ.table(aJ.clickableDateSheetTableFactory(aZ,a0)))},createMonthsheet:function(aZ,a0){return aJ.monthsheet(aZ,a0,aJ.table(aJ.clickableMonthSheetTableFactory(aZ,a0)))},createYearsheet:function(aZ,a0){return aJ.yearsheet(aZ,a0,aJ.table(aJ.clickableYearSheetTableFactory(aZ,a0)))}};aJ.clickableSheetFactory=function(){return new aY()};function Y(aZ,a0){Y.base.call(this);this._dayPoint=aZ;this._localization=a0}Y.prototype={$setCellAction:function(aZ){return aZ},table:function(aZ){this.$table=aZ;return this.set("table",aZ)},createColumn:function(a0,a1,a2){var a0=this._table.listColumns().count(),aZ=aJ.create({col:{}}),a3=aJ.create({th:{"ku-key":a1},content:aJ.create({span:{"class":"ku-table-head-content"},content:a2})});return aJ.column(a3,aZ,a0,a1,a2)},createRow:function(a0,a1){var a0=this._table.listRows().count(),aZ=(a0%2==0)?"ku-table-row ku-table-row-even":"ku-table-row ku-table-row-odd";dom=aJ.create({tr:{"class":aZ}});return aJ.row(dom,a0,a1)},createCell:function(a5,aZ,a0,a1,a2){var a7=this._table,a4=aJ.dayPoint.today(),a3=aJ.create({td:{"class":aJ.str.format("ku-date-day-{0} ku-date-week-{1}",aZ,a1)},content:aJ.str.format("<span class='ku-datesheet-cell-date'>{0}</span>",a5.date())}),a6=aJ.cell(a3,aZ,a0,a1,a2,a5).addClass("ku-sheet-date").id(a5.toString());if(a5.isBefore(a4)){a6.addClass("ku-datesheet-past")}if(a5.equals(a4)){a6.addClass("ku-datesheet-present")}if(a5.isAfter(a4)){a6.addClass("ku-datesheet-future")}if(a5.isWeekday()){a6.addClass("ku-datesheet-weekday")}if(a5.isWeekend()){a6.addClass("ku-datesheet-weekend")}if((a5.month()<this._dayPoint.month())||((a5.month()==12)&&(this._dayPoint.month()==1))){a6.addClass("ku-datesheet-lastMonth")}if(a5.month()==this._dayPoint.month()){a6.addClass("ku-datesheet-thisMonth")}if((a5.month()>this._dayPoint.month())||((a5.month()==1)&&(this._dayPoint.month()==12))){a6.addClass("ku-datesheet-nextMonth")}return this.$setCellAction(a6)}};aJ.ext(Y,aJ.Class);function ac(aZ,a0){ac.base.call(this);this._dayPoint=aZ;this._localization=a0}ac.prototype={$setCellAction:function(aZ){return aZ},table:function(aZ){this.$table=aZ;return this.set("table",aZ)},createColumn:function(a0,a1,a2){var a0=this._table.listColumns().count(),aZ=aJ.create({col:{}}),a3=aJ.create({th:{"ku-key":a1},content:aJ.create({span:{"class":"ku-table-head-content"},content:a2})});return aJ.column(a3,aZ,a0,a1,a2)},createRow:function(a0,a1){var a0=this._table.listRows().count(),aZ=(a0%2==0)?"ku-table-row ku-table-row-even":"ku-table-row ku-table-row-odd";dom=aJ.create({tr:{"class":aZ}});return aJ.row(dom,a0,a1)},createCell:function(a3,a2,a0,a1,a5){var a4=aJ.create({td:{"class":aJ.str.format("ku-month",a2,a1)},content:this._localization.month.abbr[a3.month()]}),aZ=aJ.cell(a4,a2,a0,a1,a5,a3).addClass("ku-sheet-month").id(a3.month().toString());return this.$setCellAction(aZ)}};aJ.ext(ac,aJ.Class);function d(aZ,a0){d.base.call(this);this._dayPoint=aZ;this._localization=a0}d.prototype={$setCellAction:function(aZ){return aZ},table:function(aZ){this.$table=aZ;return this.set("table",aZ)},createColumn:function(a0,a1,a2){var a0=this._table.listColumns().count(),aZ=aJ.create({col:{}}),a3=aJ.create({th:{"ku-key":a1},content:aJ.create({span:{"class":"ku-table-head-content"},content:a2})});return aJ.column(a3,aZ,a0,a1,a2)},createRow:function(a0,a1){var a0=this._table.listRows().count(),aZ=(a0%2==0)?"ku-table-row ku-table-row-even":"ku-table-row ku-table-row-odd";dom=aJ.create({tr:{"class":aZ}});return aJ.row(dom,a0,a1)},createCell:function(a3,a2,a0,a1,a5){var a4=aJ.create({td:{"class":aJ.str.format("ku-year",a2,a1)},content:a3.year()}),aZ=aJ.cell(a4,a2,a0,a1,a5,a3).addClass("ku-sheet-year").id(a3.year().toString());return this.$setCellAction(aZ)}};aJ.ext(d,aJ.Class);function aC(aZ,a0){aC.base.call(this,aZ,a0)}aC.prototype={$setCellAction:function(aZ){return aZ.onclick(function(){this.$table.selectCell(aZ)},this)}};aJ.ext(aC,Y);aJ.clickableDateSheetTableFactory=function(aZ,a0){return new aC(aZ,a0)};function S(aZ,a0){S.base.call(this,aZ,a0)}S.prototype={$setCellAction:function(aZ){return aZ.onclick(function(){this.$table.selectCell(aZ)},this)}};aJ.ext(S,ac);aJ.clickableMonthSheetTableFactory=function(aZ,a0){return new S(aZ,a0)};function X(aZ,a0){X.base.call(this,aZ,a0)}X.prototype={$setCellAction:function(aZ){return aZ.onclick(function(){this.$table.selectCell(aZ)},this)}};aJ.ext(X,d);aJ.clickableYearSheetTableFactory=function(aZ,a0){return new X(aZ,a0)};var M=function(aZ,a0){M.base.call(this,aZ);this.localization(a0);this._onSelect=aJ.observer()};M.prototype={$findCell:function(aZ){return null},localization:function(aZ){return this.property("localization",aZ)},each:function(a0,aZ){this.$sheet.listCells().each(a0,aZ);return this},findCell:function(aZ){return this.$findCell(aZ)},selectCell:function(aZ){if(!aJ.exists(aZ)){return this}this._onSelect.notify(aZ);return this},select:function(aZ){return this.selectCell(this.findCell(aZ))},onSelect:function(a0,aZ){this._onSelect.add(a0,aZ);return this},destroy:function(){this.$sheet.listCells().each(function(aZ){if(aJ.exists(aZ.deallocate)){aZ.deallocate()}aZ.clearEvents();return this})}};aJ.ext(M,aJ.dom.Class);var g=function(aZ,a1,a0){this._firstDateOfSheet=A(aZ);this.$sheet=a0.onCellSelect(this.selectCell,this);g.base.call(this,this.$sheet.dom(),a1);aI(this);ag(this)};g.prototype={$findCell:function(aZ){return this.$sheet.findCellById(aZ.toString())}};aJ.ext(g,M);aJ.datesheet=function(aZ,a1,a0){return(new g(aZ,a1,a0))};function A(aZ){var a1=aZ.firstDayOfMonth(),a2=aZ.firstDayOfMonth(),a0=false;while(a2.day()>0||!a0){if(a2.day()==0){a0=true}a2=a2.prevDay()}return a2}function aI(a1){var a4=a1.localization().day.abbr,a3=a1.$sheet,a2=7,a0=0;while(a0<a2){var aZ=a4[a0];a3.addColumn(aZ,{},aZ);a0++}}function ag(a2){var a3=a2.$sheet,aZ=a2._firstDateOfSheet,a1=0;while(a1<7){var a0=av(a2,aZ);aZ=aZ.add(0,0,7);a3.addRow(aJ.uid(),a0);a1++}}function av(a0,aZ){var a1=aZ,a2={};a0.$sheet.listColumns().each(function(a3){a2[a3.key()]=a1;a1=a1.nextDay()});return a2}var U=function(aZ,a1,a0){this._firstDateOfSheet=aN(aZ);this.$sheet=a0.onCellSelect(this.selectCell,this);U.base.call(this,this.$sheet.dom(),a1);e(this);ab(this)};U.prototype={$findCell:function(aZ){return this.$sheet.findCellById(aZ.month())}};aJ.ext(U,M);aJ.monthsheet=function(aZ,a1,a0){return(new U(aZ,a1,a0))};function aN(aZ){return aJ.dayPoint(aZ.year(),1,aZ.date())}function e(a2){var a0=a2.localization().month.abbr,a3=a2.$sheet,aZ=4,a1=1;while(a1<=aZ){a3.addColumn(a1,null,"");a1++}}function ab(a2){var a3=a2.$sheet,a0=a2._firstDateOfSheet,a1=1;while(a1<=3){var aZ=O(a2,a0);a0=a0.add(0,4,0);a3.addRow(aJ.uid(),aZ);a1++}}function O(a0,aZ){var a1=aZ,a2={};a0.$sheet.listColumns().each(function(a3){a2[a3.key()]=a1;a1=a1.nextMonth()});return a2}var D=function(aZ,a1,a0){this._firstDateOfSheet=am(aZ);this.$sheet=a0.onCellSelect(this.selectCell,this);D.base.call(this,this.$sheet.dom(),a1);W(this);L(this)};D.prototype={$findCell:function(aZ){return this.$sheet.findCellById(aZ.year())}};aJ.ext(D,M);aJ.yearsheet=function(aZ,a1,a0){return(new D(aZ,a1,a0))};function am(aZ){return aZ.add(-12,0,0)}function W(a2){var aZ=a2.localization().month.abbr,a3=a2.$sheet,a0=5,a1=0;while(a1<a0){a3.addColumn(a1,null,"");a1++}}function L(a2){var a3=a2.$sheet,aZ=a2._firstDateOfSheet,a1=0;while(a1<5){var a0=ap(a2,aZ);aZ=aZ.add(5,0,0);a3.addRow(aJ.uid(),a0);a1++}}function ap(a0,aZ){var a1=aZ,a2={};a0.$sheet.listColumns().each(function(a3){a2[a3.key()]=a1;a1=a1.nextYear()});return a2}function p(aZ){p.base.call(this,aZ);this._id=aJ.uid("dropper");this._handle=this}p.prototype={id:function(aZ){return this.get("id")},value:function(aZ){return this.property("value",aZ)},handle:function(aZ){var a0;if(aJ.exists(aZ)){a0=aJ.dom(aZ)}return this.property("handle",a0)},mouseEventId:function(aZ){return this.property("mouseEventId",aZ)},touchEventId:function(aZ){return this.property("touchEventId",aZ)},};aJ.ext(p,aJ.dom.Class);aJ.dndScreenDropper=function(aZ){return new p(aZ)};var ad=function(){this._targets=aJ.hash();this._droppers=aJ.hash();this._onHit=aJ.observer();this._lastKnownCoord;this._helper=aJ.sprite(aJ.create({div:{"class":"ku-dndScreen-helper"}})).onGrab(function(a0){var aZ=aJ.touch().canRead(a0)?aJ.touch():aJ.mouse();this._lastKnownCoord=aZ.documentCoord(a0)},this).onDrag(function(a0){var aZ=aJ.touch().canRead(a0)?aJ.touch():aJ.mouse();this._lastKnownCoord=aZ.documentCoord(a0)},this).onDrop(function(aZ){this._drop(aZ)},this);this._currentDropper};ad.prototype={addTarget:function(aZ){this._targets.add(aZ.id(),aZ);return this},removeTarget:function(aZ){this._targets.remove(aZ.id(),aZ);return this},addDropper:function(a1){var a2=aJ.uid("dropperEvent"),aZ=aJ.uid("dropperEvent");function a0(a3){this._currentDropper=a1;this.activateHelper(a3,a1)}a1.mouseEventId(a2).touchEventId(aZ).handle().onmousedown(a0,this,a2).ontouchstart(a0,this,aZ);this._droppers.add(a1.id(),a1)},removeDropper:function(aZ){aZ.handle().removeEvent(aZ.touchEventId()).removeEvent(aZ.mouseEventId());this._droppers.remove(aZ.id())},activateHelper:function(a0,aZ){this._helper.appendTo(document.body).pinTo(aZ.offset().subtract(aZ.scrollOffset()).add(aJ.window().scrollOffset())).content(aZ.cloneNode()).grab(a0)},deactivateHelper:function(){this._helper.html("").detach();this._currentDropper=undefined},clearTargets:function(){this._targets.clear();return this},clearDroppers:function(){var aZ=this._droppers;aZ.listValues().each(function(a0){this.removeDropper(a0)},this);return this},clearAll:function(){this.clearTargets().clearDroppers();return this},clearListeners:function(){this._onHit.clear();return this},onHit:function(a0,aZ){this._onHit.add(a0,aZ);return this},_drop:function(a1){var aZ=this._findHitTarget(a1),a0=this._currentDropper;if(aJ.exists(aZ)&&aJ.exists(a0)){this._onHit.notify(aZ,a0)}this.deactivateHelper()},_findHitTarget:function(a2){var aZ=this._targets.listValues(),a1=aJ.touch().canRead(a2)?aJ.touch():aJ.mouse(),a0=null,a3;try{a3=a1.documentCoord(a2)}catch(a2){a3=this._lastKnownCoord}aZ.each(function(a4){if(!a4.contains(a3)){return}a0=a4;aZ.quit()});return a0}};aJ.dndScreen=function(){return new ad()};function at(aZ){at.base.call(this,aZ);this._id=aJ.uid("target")}at.prototype={id:function(aZ){return this.get("id")},value:function(aZ){return this.property("value",aZ)},contains:function(a1){var a0=this.offset(),aZ=a0.add(this.outerDims());return aJ.rectangle(a0,aZ).contains(a1)}};aJ.ext(at,aJ.dom.Class);aJ.dndScreenTarget=function(aZ){return new at(aZ)};function ay(aZ){ay.base.call(this,aZ);this._isinvalid=false;this._keyup=aJ.uid();this._$dom=aJ.dom(this.dom());this.onInvalid(this.invalidate,this).onIsValid(this.validate,this)}ay.prototype={$clear:function(){return this.value("").validate()},tooltip:function(aZ){return this.set("tooltip",aZ)},invalidate:function(){if(this._isinvalid){return this}this._isinvalid=true;this._$dom.addClass("ku-field-error").onchange(this.isValid,this,this._keyup);var aZ=this._tooltip;if(aJ.exists(aZ)){aZ.show().rightOf(this.dom())}return this},validate:function(){if(!this._isinvalid){return this}this._isinvalid=false;this._$dom.removeClass("ku-field-error").removeEvent(this._keyup);var aZ=this._tooltip;if(aJ.exists(aZ)){aZ.hide()}return this}};aJ.ext(ay,aJ.checkbox.Class);function az(aZ){az.base.call(this,aZ);this._isinvalid=false;this._keyupid=aJ.uid();this._$dom=aJ.dom(this.dom());this.onInvalid(this.invalidate,this).onIsValid(this.validate,this)}az.prototype={$clear:function(){return this.value("").validate()},tooltip:function(aZ){return this.set("tooltip",aZ)},watermark:function(aZ){return this.set("watermark",aZ)},invalidate:function(){if(this._isinvalid){return this}this._isinvalid=true;this._$dom.addClass("ku-field-error").onkeyup(this.isValid,this,this._keyupid);var aZ=this._tooltip;if(aJ.exists(aZ)){aZ.show().rightOf(this.dom())}return this},validate:function(){if(!this._isinvalid){return this}this._isinvalid=false;this._$dom.removeClass("ku-field-error").removeEvent(this._keyupid);var aZ=this._tooltip;if(aJ.exists(aZ)){aZ.hide()}return this}};aJ.ext(az,aJ.field.Class);function aP(aZ){aP.base.call(this,aZ);this._isinvalid=false;this._keyup=aJ.uid();this._$dom=aJ.dom(this.dom());this.onInvalid(this.invalidate,this).onIsValid(this.validate,this)}aP.prototype={$clear:function(){return this.value("").validate()},tooltip:function(aZ){return this.set("tooltip",aZ)},invalidate:function(){if(this._isinvalid){return this}this._isinvalid=true;this._$dom.addClass("ku-field-error").onchange(this.isValid,this,this._keyup);var aZ=this._tooltip;if(aJ.exists(aZ)){aZ.show().rightOf(this.dom())}return this},validate:function(){if(!this._isinvalid){return this}this._isinvalid=false;this._$dom.removeClass("ku-field-error").removeEvent(this._keyup);var aZ=this._tooltip;if(aJ.exists(aZ)){aZ.hide()}return this}};aJ.ext(aP,aJ.select.Class);function q(aZ){q.base.call(this,aZ);this.tooltip(aJ.tooltip().message("Invalid"))}aJ.ext(q,ay);aJ.fields.checkbox=function(aZ){return new q(aZ)};function Z(aZ){Z.base.call(this,aZ);this._id=aJ.uid("field");this._isShow=false;this._calendar=aJ.calendarControlsDecorator(aJ.calendar()).onSelect(function(a0){this.value(a0.value().toString()).validate();this.hideCalendar()},this).showDates();this._calContainer=aJ.tooltip().pointer(aJ.sprite(aJ.create({div:{"class":"ku-dayPointField-tooltip-pointer"}})).hide().dragOff()).tooltip(aJ.sprite(aJ.create({div:{"class":"ku-dayPointField-tooltip"}})).hide().dragOff()).message(this._calendar.dom());this._$dom=aJ.dom(this.dom()).onfocus(this._focusAction,this).onkeyup(this._keyupAction,this).onkeydown(this._keydownAction,this);this.spec(aJ.fields.specs.date).tooltip(aJ.tooltip().message("Enter a valid date."))}Z.prototype={$read:function(){return(aJ.dayPoint.tryParse(this.dom().value)||"").toString()},$write:function(aZ){this.dom().value=(aJ.dayPoint.tryParse(aZ)||aZ).toString()},showCalendar:function(){if(this._isShow){return}this._isShow=true;this._calContainer.show().at(this.dom(),["below","above"]);aJ.window().onmouseup(this._hideCalendar,this,this._id);return this},hideCalendar:function(aZ){this._calContainer.hide();this._calendar.detach();aJ.window().remove(this._id);this._isShow=false;return this},_hideCalendar:function(a4){var aZ=this._calendar,a2=aZ.offset(),a1=a2.add(aZ.outerDims()),a5=this._$dom,a8=a5.offset(),a7=a8.add(a5.outerDims()),a0=aJ.rectangle(a2,a1),a6=aJ.rectangle(a8,a7),a3=aJ.mouse().documentCoord(a4);if(a0.contains(a3)||a6.contains(a3)){return this}this.hideCalendar();return this},_focusAction:function(aZ){this.showCalendar();return this},_keyupAction:function(aZ){this.showCalendar();return this},_keydownAction:function(a1){var aZ=aJ.key.parse(a1),a0=aJ.key(9),a2=aJ.key(9,false,false,true);if(aZ.equals(a0)||aZ.equals(a2)){this.hideCalendar()}return this}};aJ.ext(Z,az);aJ.fields.dayPoint=function(aZ){return new Z(aZ)};function B(aZ){B.base.call(this,aZ);this.spec(aJ.fields.specs.email).tooltip(aJ.tooltip().message("Enter a valid email address."))}B.prototype={$read:function(){return this.dom().value},$write:function(aZ){this.dom().value=aZ}};aJ.ext(B,az);aJ.fields.email=function(aZ){return new B(aZ)};function N(aZ){N.base.call(this,aZ);this.tooltip(aJ.tooltip().message("Invalid"))}aJ.ext(N,az);aJ.fields.field=function(aZ){return new N(aZ)};function v(aZ){v.base.call(this,aZ);this.spec(aJ.fields.specs.currency).tooltip(aJ.tooltip().message("Enter a valid money amount."));aJ.dom(this.dom()).onblur(function(){this.value(this.value())},this)}v.prototype={$read:function(){var aZ=this.dom().value;return(aJ.money.canParse(aZ))?aJ.money.parse(aZ).value():aZ},$write:function(aZ){this.dom().value=aJ.money.tryParse(aZ)||aZ}};aJ.ext(v,az);aJ.fields.money=function(aZ){return new v(aZ)};function z(aZ){z.base.call(this,aZ);this.spec(aJ.fields.specs.phone).tooltip(aJ.tooltip().message("Enter a valid phone number including area code."));aJ.dom(this.dom()).onblur(function(){this.value(this.value())},this)}z.prototype={$read:function(){return this.dom().value.replace(/[^\d]/g,"")},$write:function(aZ){this.dom().value=(function(a2,a4){var a1=a2.replace(/[^\d]/g,"").split(/\B/),a3=0,a0=a1.length,a5=(a0<11)?a4.replace(/^#\s/,""):a4;while(a3<a0){a5=a5.replace("#",a1[a3]);a3++}return(/#/.test(a5))?aZ:a5})(aZ,"# (###) ###-####")}};aJ.ext(z,az);aJ.fields.phone=function(a0,aZ){return new z(a0,aZ)};function K(aZ){K.base.call(this,aZ);this.tooltip(aJ.tooltip().message("Invalid"))}aJ.ext(K,aP);aJ.fields.select=function(aZ){return new K(aZ)};function r(){}r.prototype={highlight:function(a2,a0){var aZ=a2.getRangeAt(0);try{document.designMode="on";a2.removeAllRanges();a2.addRange(aZ);if(!document.execCommand("HiliteColor",false,a0)){document.execCommand("BackColor",false,a0)}document.designMode="off"}catch(a3){try{aZ=document.selection.createRange();aZ.execCommand("BackColor",false,a0)}catch(a1){}}},clear:function(){}};aJ.highlighter=function(){return new r()};function h(){this._onKeyPressed=aJ.observer();h.base.call(this,aJ.create({div:{"class":"ku-keyboard"}}))}h.prototype={addKey:function(aZ){aJ.onScreenKey(aZ).addClass(aJ.str.format("ku-keyboard-key ku-key-{0}",aZ)).onPress(this._onKeyPressed.notify,this._onKeyPressed).appendTo(this.dom());return this},onKeyPressed:function(a0,aZ){this._onKeyPressed.add(a0,aZ);return this}};aJ.ext(h,aJ.dom.Class);aJ.onScreenKeyboard=function(){return new h()};function an(aZ){if(!aJ.isNumber(aZ)){aJ.exception("arg",aJ.str.format("Invalid argument code:{0}",aZ))}this._value=aJ.key(aZ);this._onPress=aJ.observer();this._onRelease=aJ.observer();an.base.call(this,aJ.create({button:{"class":"ku-keyboard-key"},content:this._value.toString()}));this.onmousedown(function(){this._onPress.notify(this._value)},this).ontouchstart(function(){this._onPress.notify(this._value)},this).onmouseup(function(){this._onRelease.notify(this._value)},this).ontouchend(function(){this._onRelease.notify(this._value)},this)}an.prototype={onPress:function(a0,aZ){this._onPress.add(a0,aZ);return this},onRelease:function(a0,aZ){this._onRelease.add(a0,aZ);return this}};aJ.ext(an,aJ.dom.Class);aJ.onScreenKey=function(aZ){return new an(aZ)};function H(aZ){H.base.call(this,aZ)}H.prototype={value:function(){},ratio:function(){return this.minValue()/this.maxValue()},minValue:function(aZ){this.get("minValue",aZ)},maxValue:function(aZ){this.get("maxValue",aZ)}};aJ.ext(H,aJ.dom.Class);function aq(){}aq.prototype={};function w(a0){var aZ=a0||aJ.create({div:{"class":"ku-sprite"}});w.base.call(this,aZ);this.to().dragOn().force(0.4).mu(0.8);this._isTo}w.prototype={force:function(aZ){return this.property("force",aZ)},mu:function(aZ){return this.property("mu",aZ)},algorithm:function(aZ){return this.set("algorithm",aZ)},to:function(){this._isTo=true;return this.algorithm(aJ.anime.algorithms.jump())},spring:function(){this._isTo=false;return this.algorithm(aJ.anime.algorithms.spring(this._force,this._mu))},ease:function(){this._isTo=false;return this.algorithm(aJ.anime.algorithms.ease.linear(this._force,this._mu))},fitTo:function(a1,a0,aZ){return this._act("fitter",a1,a0,aZ)},sizeTo:function(a1,a0,aZ){return this._act("sizer",a1,a0,aZ)},pinTo:function(a1,a0,aZ){return this._act("pinner",a1,a0,aZ)},scrollTo:function(a1,a0,aZ){return this._act("scroller",a1,a0,aZ)},fadeTo:function(aZ,a1,a0){return this._act("fader",aZ,a1,a0)},growTo:function(a1,a0,aZ){return this.sizeTo(a1).pinTo(this.boundedOffset().subtract(a1.subtract(this.outerDims()).half()),a0,aZ)},_act:function(a5,a4,a3,a2){var a0=aJ[a5](this.dom()).algorithm(this._algorithm),aZ="_"+a5,a1=this[aZ];if(aJ.exists(a1)){a1.stop()}if(aJ.exists(a3)){a0.onEnd(a3,a2)}if(this._isTo){this[aZ]=a0.to(a4)}else{this[aZ]=a0.moveTo(a4)}return this},tween:function(a0,aZ){this._styler=aJ.styler(this.dom(),a0).algorithm(this._algorithm).moveTo(aZ);return this},clear:function(){if(aJ.exists(this._fader)){this._fader.stop()}if(aJ.exists(this._sizer)){this._sizer.stop()}if(aJ.exists(this._fitter)){this._fitter.stop()}if(aJ.exists(this._pinner)){this._pinner.stop()}if(aJ.exists(this._scroller)){this._scroller.stop()}if(aJ.exists(this._styler)){this._styler.stop()}return this},dragHandle:function(aZ){return this.property("dragHandle",aZ)},dragType:function(aZ){return this.set("dragType",aZ)},dragOffset:function(aZ){this._dnd.dragOffset(aZ);return this},dragger:function(){this._dnd.dragger();return this},sizer:function(){this._dnd.sizer();return this},scroller:function(){this._dnd.scroller();return this},dragOn:function(){this._dnd=aJ.dnd(this.dom()).onGrab(this.clear,this);return this},dragOff:function(){this._dnd.destroy();return this},onGrab:function(a0,aZ,a1){this._dnd.onGrab(a0,aZ,a1);return this},onDrag:function(a0,aZ,a1){this._dnd.onDrag(a0,aZ,a1);return this},onDrop:function(a0,aZ,a1){this._dnd.onDrop(a0,aZ,a1);return this},bearingUp:function(){return this._dnd.bearingUp()},bearingDown:function(){return this._dnd.bearingDown()},bearingLeft:function(){return this._dnd.bearingLeft()},bearingRight:function(){return this._dnd.bearingRight()},grab:function(aZ){this._dnd.grab(aZ);return this},drag:function(aZ){this._dnd.drag(aZ);return this},drop:function(aZ){this._dnd.drop(aZ);return this},constrainX:function(){this._dnd.constrainX();return this},unconstrainX:function(){this._dnd.unconstrainX();return this},constrainY:function(){this._dnd.constrainY();return this},unconstrainY:function(){this._dnd.unconstrainY();return this}};aJ.ext(w,aJ.dom.Class);aJ.sprite=function(aZ){return new w(aZ)};aJ.sprite.Class=w;var aR=function(aZ,a0){this.$offset=0;this.$multiplier=a0;this._tooltip=aZ;this.overlap(0)};aR.prototype={$above:function(aZ,a1,a0){return},$below:function(aZ,a1,a0){return},$leftOf:function(aZ,a1,a0){return},$rightOf:function(aZ,a1,a0){return},overlap:function(aZ){return this.set("overlap",aZ)},above:function(a3){var a1=this._tooltip,aZ=a1.context(a3).context(),a2=a1.pointer(),a0=a1.tooltip();this.$offset=this._overlap;this.$above(aZ,a2,a0);return this},below:function(a3){var a1=this._tooltip,aZ=a1.context(a3).context(),a2=a1.pointer(),a0=a1.tooltip();this.$offset=this._overlap;this.$below(aZ,a2,a0);return this},leftOf:function(a3){var a1=this._tooltip,aZ=a1.context(a3).context(),a2=a1.pointer(),a0=a1.tooltip();this.$offset=this._overlap;this.$leftOf(aZ,a2,a0);return this},rightOf:function(a3){var a1=this._tooltip,aZ=a1.context(a3).context(),a2=a1.pointer(),a0=a1.tooltip();this.$offset=this._overlap;this.$rightOf(aZ,a2,a0);return this}};aJ.ext(aR,aJ.Class);var aX=function(aZ,a0){aX.base.call(this,aZ,0.5)};aX.prototype={$above:function(aZ,a1,a0){a1.pinTo(aZ.offset().subtract(a1.outerHeight()).add(aJ.coord(aZ.outerDims().subtract(a1.outerDims()).x()*this.$multiplier,0)));a0.pinTo(a1.offset().subtract(a0.outerHeight()).add(aJ.coord(0,this.$offset)).add(aJ.coord(a1.outerDims().subtract(a0.outerDims()).x()*this.$multiplier,0)));a1.fadeTo(100);a0.fadeTo(100);return this},$below:function(aZ,a1,a0){a1.pinTo(aZ.offset().add(aZ.outerHeight()).add(aJ.coord(aZ.outerDims().subtract(a1.outerDims()).x()*this.$multiplier,0)));a0.pinTo(a1.offset().add(a1.outerHeight()).subtract(aJ.coord(0,this.$offset)).add(aJ.coord(a1.outerDims().subtract(a0.outerDims()).x()*this.$multiplier,0)));a1.fadeTo(100);a0.fadeTo(100);return this},$leftOf:function(aZ,a1,a0){a1.pinTo(aZ.offset().subtract(a1.outerWidth()).add(aJ.coord(0,aZ.outerDims().subtract(a1.outerDims()).y()*this.$multiplier)));a0.pinTo(a1.offset().subtract(a0.outerWidth()).add(aJ.coord(this.$offset,0)).add(aJ.coord(0,a1.outerDims().subtract(a0.outerDims()).y()*this.$multiplier)));a1.fadeTo(100);a0.fadeTo(100);return this},$rightOf:function(aZ,a1,a0){a1.pinTo(aZ.offset().add(aZ.outerWidth()).add(aJ.coord(0,aZ.outerDims().subtract(a1.outerDims()).y()*this.$multiplier)));a0.pinTo(a1.offset().add(a1.outerWidth()).subtract(aJ.coord(this.$offset,0)).add(aJ.coord(0,a1.outerDims().subtract(a0.outerDims()).y()*this.$multiplier)));a1.fadeTo(100);a0.fadeTo(100);return this}};aJ.ext(aX,aR);var aF=function(aZ,a0){aF.base.call(this,aZ,0)};aF.prototype={$above:function(aZ,a1,a0){a1.pinTo(aZ.offset().subtract(a1.outerHeight()).add(aJ.coord(this.$offset,0)).add(aJ.coord(aZ.outerDims().subtract(a1.outerDims()).x()*this.$multiplier,0)));a0.pinTo(a1.offset().subtract(a0.outerHeight()).add(aJ.coord(-this.$offset,this.$offset)).add(aJ.coord(a1.outerDims().subtract(a0.outerDims()).x()*this.$multiplier,0)));a1.fadeTo(100);a0.fadeTo(100);return this},$below:function(aZ,a1,a0){a1.pinTo(aZ.offset().add(aZ.outerHeight()).add(aJ.coord(this.$offset,0)).add(aJ.coord(aZ.outerDims().subtract(a1.outerDims()).x()*this.$multiplier,0)));a0.pinTo(a1.offset().add(a1.outerHeight()).subtract(aJ.coord(this.$offset,this.$offset)).add(aJ.coord(a1.outerDims().subtract(a0.outerDims()).x()*this.$multiplier,0)));a1.fadeTo(100);a0.fadeTo(100);return this},$leftOf:function(aZ,a1,a0){a1.pinTo(aZ.offset().subtract(a1.outerWidth()).add(aJ.coord(0,this.$offset)).add(aJ.coord(0,aZ.outerDims().subtract(a1.outerDims()).y()*this.$multiplier)));a0.pinTo(a1.offset().subtract(a0.outerWidth()).add(aJ.coord(this.$offset,-this.$offset)).add(aJ.coord(0,a1.outerDims().subtract(a0.outerDims()).y()*this.$multiplier)));a1.fadeTo(100);a0.fadeTo(100);return this},$rightOf:function(aZ,a1,a0){a1.pinTo(aZ.offset().add(aZ.outerWidth()).add(aJ.coord(0,this.$offset)).add(aJ.coord(0,aZ.outerDims().subtract(a1.outerDims()).y()*this.$multiplier)));a0.pinTo(a1.offset().add(a1.outerWidth()).subtract(aJ.coord(this.$offset,this.$offset)).add(aJ.coord(0,a1.outerDims().subtract(a0.outerDims()).y()*this.$multiplier)));a1.fadeTo(100);a0.fadeTo(100);return this}};aJ.ext(aF,aR);var ao=function(aZ,a0){ao.base.call(this,aZ,1)};ao.prototype={$above:function(aZ,a1,a0){a1.pinTo(aZ.offset().subtract(a1.outerHeight()).add(aJ.coord(-this.$offset,0)).add(aJ.coord(aZ.outerDims().subtract(a1.outerDims()).x()*this.$multiplier,0)));a0.pinTo(a1.offset().subtract(a0.outerHeight()).add(aJ.coord(this.$offset,this.$offset)).add(aJ.coord(a1.outerDims().subtract(a0.outerDims()).x()*this.$multiplier,0)));a1.fadeTo(100);a0.fadeTo(100);return this},$below:function(aZ,a1,a0){a1.pinTo(aZ.offset().add(aZ.outerHeight()).add(aJ.coord(-this.$offset,0)).add(aJ.coord(aZ.outerDims().subtract(a1.outerDims()).x()*this.$multiplier,0)));a0.pinTo(a1.offset().add(a1.outerHeight()).add(aJ.coord(this.$offset,-this.$offset)).add(aJ.coord(a1.outerDims().subtract(a0.outerDims()).x()*this.$multiplier,0)));a1.fadeTo(100);a0.fadeTo(100);return this},$leftOf:function(aZ,a1,a0){a1.pinTo(aZ.offset().subtract(a1.outerWidth()).add(aJ.coord(0,-this.$offset)).add(aJ.coord(0,aZ.outerDims().subtract(a1.outerDims()).y()*this.$multiplier)));a0.pinTo(a1.offset().subtract(a0.outerWidth()).add(aJ.coord(this.$offset,this.$offset)).add(aJ.coord(0,a1.outerDims().subtract(a0.outerDims()).y()*this.$multiplier)));a1.fadeTo(100);a0.fadeTo(100);return this},$rightOf:function(aZ,a1,a0){a1.pinTo(aZ.offset().add(aZ.outerWidth()).add(aJ.coord(0,-this.$offset)).add(aJ.coord(0,aZ.outerDims().subtract(a1.outerDims()).y()*this.$multiplier)));a0.pinTo(a1.offset().add(a1.outerWidth()).add(aJ.coord(-this.$offset,this.$offset)).add(aJ.coord(0,a1.outerDims().subtract(a0.outerDims()).y()*this.$multiplier)));a1.fadeTo(100);a0.fadeTo(100);return this}};aJ.ext(ao,aR);var F=function(){F.base.call(this);this.pointer(aJ.sprite(aJ.create({div:{"class":"ku-tooltip-pointer"}})).hide().dragOff().to()).tooltip(aJ.sprite(aJ.create({div:{"class":"ku-tooltip"}})).hide().dragOff().to()).leftJustify();this._id=aJ.uid("tip");this._onShow=aJ.observer();this._onHide=aJ.observer()};F.prototype={calibrate:function(aZ){return this.property("calibrate",aZ)},pointer:function(aZ){return this.property("pointer",aZ)},tooltip:function(aZ){return this.property("tooltip",aZ)},strategy:function(aZ){return this.property("strategy",aZ)},message:function(aZ){return this.property("message",aZ)},context:function(a0){var aZ=(aJ.exists(a0))?aJ.dom(a0):a0;return this.property("context",aZ)},center:function(){return this.strategy(new aX(this))},leftJustify:function(){return this.strategy(new aF(this))},rightJustify:function(){return this.strategy(new ao(this))},onShow:function(a0,aZ){this._onShow.add(a0,aZ);return this},onHide:function(a0,aZ){this._onHide.add(a0,aZ);return this},show:function(a1){var aZ=a1||this._message,a0=aZ||"";this._pointer.fadeTo(0).appendTo(document.body).show();this._tooltip.fadeTo(0).appendTo(document.body).html("").content(a0).show();this._onShow.notify();return this},hide:function(){this._pointer.hide().detach();this._tooltip.hide().detach();this._onHide.notify();return this},at:function(a4,a0){var a2=aJ.window(),a3=aJ.dom(a4),aZ=aJ.coord.zero(),a5=a2.dims(),a1=a3.offset();b=a1.add(a3.outerDims()),C=this._tooltip.outerDims(),bPlusC=b.add(C),aLessC=a1.subtract(C),rightOf=!bPlusC.isRightOf(a5),below=!bPlusC.isBelow(a5),leftOf=!aLessC.isLeftOf(aZ),above=!aLessC.isAbove(aZ),prefer={rightOf:rightOf,below:below,leftOf:leftOf,above:above};if(prefer[a0[0]]){return this[a0[0]](a4)}if(prefer[a0[1]]){return this[a0[1]](a4)}if(prefer[a0[2]]){return this[a0[2]](a4)}if(prefer[a0[3]]){return this[a0[3]](a4)}return this.rightOf(a4)},above:function(aZ){return this._locate(aZ,"bottom","above")},below:function(aZ){return this._locate(aZ,"top","below")},leftOf:function(aZ){return this._locate(aZ,"right","leftOf")},rightOf:function(aZ){return this._locate(aZ,"left","rightOf")},_locate:function(a1,a0,aZ){this.strategy().overlap(aV(this,a0))[aZ](a1);aS(this,aZ);this._pointer.fadeTo(100);this._tooltip.fadeTo(100);return this}};aJ.ext(F,aJ.Class);aJ.tooltip=function(){return new F()};function aV(a1,a0){var aZ=a1.tooltip().style(aJ.str.format("border-{0}-width",a0));return aJ.ku.style.toNumber(aZ)}function aS(a1,aZ){var a2="ku-{0}",a0=["above","below","leftOf","rightOf"],a3=a1.pointer();for(var a4 in a0){a3.removeClass(aJ.str.format(a2,a0[a4]))}a3.addClass(aJ.str.format(a2,aZ))}function aA(aZ){this._target=aJ.sprite(aZ).dragOff();this._helper=aJ.sprite(aJ.create({div:{"class":"ku-droptarget-helper",style:"position:absolute;"},content:"helper"})).fadeTo(30).hide();this._observer=aJ.observer()}aA.prototype={add:function(a1,a0,aZ){this._observer.add(aJ.uid("drop"),evtId)},remove:function(aZ){},_hits:function(a2){var aZ=aJ.mouse().documentCoord(a2),a0=this.tl,a1=this.br;return aZ.isRightOf(a0)&&aZ.isBelow(a0)&&aZ.isLeftOf(a1)&&aZ.isAbove(a1)}};aJ.ext(aA,aJ.dom.Class);aJ.droptarget=function(aZ){return new aA(aZ)};function P(aZ,a0){P.base.call(this);var a1=aJ.dom(aZ).addClass("ku-file-tab").onclick(this.invoke,this),a2=aJ.dom(a0).addClass("ku-file-content"),a3="ku-file-active";this.onActive(function(){a1.addClass(a3);a2.addClass(a3)}).onInactive(function(){a1.removeClass(a3);a2.removeClass(a3)})}P.prototype={};aJ.ext(P,aJ.toggle.Class);function s(aZ){s.base.call(this);var a0=aJ.dom(aZ).addClass("ku-file-content"),a1="ku-file-active";this.onActive(function(){a0.addClass(a1)}).onInactive(function(){a0.removeClass(a1)})}s.prototype={};aJ.ext(s,aJ.toggle.Class);aJ.file=function(aZ,a0){return(aJ.exists(aZ))?new P(aZ,a0):new s(a0)};function ae(){ae.base.call(this);this.mutuallyExclusive()}ae.prototype={};aJ.ext(ae,aJ.toggleset.Class);aJ.fileCabinet=function(){return new ae()};aJ.mouseLogger=function(){var aZ=aJ.create({div:{style:{position:"absolute"}}});return{on:function(){document.body.appendChild(aZ);this.__con=new aJ.sprite(aZ);this.__evt=aJ.evt.add(document,"mousemove",function(a4){var a2=aJ.str.build("Document:&nbsp;{0}<br/>Page:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{1}","<br/>Screen:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{2}","<br/>Client:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{3}","<br/>Target:&nbsp;{4}"),a5=aJ.mouse().documentCoord(a4),a3=aJ.mouse().pageCoord(a4),a1=aJ.mouse().screenCoord(a4),a6=aJ.mouse().clientCoord(a4),a0=aJ.mouse().target(a4);this.__con.pinTo(aJ.mouse().documentCoord(a4).add(aJ.coord(10,10))).html(aJ.str.format(a2,a5.toString(),a3.toString(),a1.toString(),a6.toString(),a0))},this)},off:function(){document.body.removeChild(aZ);var a0=this.__evt,a1=this.__con;if(aJ.exists(a0)){aJ.evt.remove(a0)}if(aJ.exists(a1)){a1.destroy()}}}};function J(aZ){J.base.call(this,aZ);this._velocityId=aJ.uid("projectile");this._flyId=aJ.uid("projectile");this.gravity(aJ.vector(0,0.5)).friction(0.98).velocity(aJ.vector.zero()).lowerBound(aJ.coord.zero()).upperBound(aJ.window.dims()).lastCoord(this.offset()).onDrop(function(){ax(this,this._velocityId,this._flyId)},this).onGrab(function(){this.velocity(aJ.vector.zero());aJ.timeline().remove(this._flyId).add(function(){n(this)},this,this._velocityId)},this)}J.prototype={gravity:function(aZ){return this.property("gravity",aZ)},friction:function(aZ){return this.property("friction",aZ)},velocity:function(aZ){return this.property("velocity",aZ)},lowerBound:function(aZ){return this.property("lowerBound",aZ)},upperBound:function(aZ){return this.property("upperBound",aZ)},lastCoord:function(aZ){return this.property("lastCoord",aZ)},stop:function(){aJ.timeline().remove(this._velocityId).remove(this._flyId);return this}};aJ.ext(J,aJ.sprite.Class);aJ.projectile=function(aZ){return new J(aZ)};function n(aZ){aZ.velocity(aZ.offset().distanceFrom(aZ.lastCoord()));aZ.lastCoord(aZ.offset())}function ax(a0,aZ,a1){aJ.timeline().remove(aZ).add(function(){aM(this)},a0,a1)}function aM(bd){var ba=bd.velocity(),a0=bd.boundedOffset(),a5=bd.outerDims(),aZ=a0.add(a5),a4=bd.lowerBound(),a9=bd.upperBound(),bc=(a0.isAbove(a4)&&(ba.y()<=0))||(aZ.isBelow(a9)&&(ba.y()>=0)),bb=(a0.isLeftOf(a4)&&(ba.x()<=0))||(aZ.isRightOf(a9)&&(ba.x()>=0)),a1=(bc||bb)?0.8:1,a3=bc?aJ.vector(0,1):bb?aJ.vector(1,0):aJ.vector.zero(),a8=ba.add(bd.gravity()).scale(bd.friction()).scale(a1).reflect(a3),a6=a8.magnatude()>1||a0.isAbove(a9.add(a5).add(aJ.coord(0,10))),a2=a6?a8:aJ.vector.zero(),a7=a6?a0.add(a2):aJ.coord(a0.x(),a9.subtract(a5).y());bd.velocity(a2).pinTo(a7)}function E(){var a0=aJ.create({div:{"class":"ku-responsebox"}}),aZ=aJ.uid("responsebox");E.base.call(this,a0);this._contentDom=aJ.sprite(aJ.create({div:{"class":"ku-responsebox-content"}})).fadeTo(0).dragOff().force(0.4).ease();this._onOpen=aJ.observer();this._onClose=aJ.observer();this._onCalibrate=aJ.observer();this._onWindowResize=aJ.observer();this._onContentChanged=aJ.observer();this._closeSize=aJ.coord.zero();this._isOpen=false;this.force(0.8).mu(0.5).appendChild(this._contentDom.dom()).positionStrategy(function(){return aJ.window().scrollCenter()}).bounds(document.body).to();aJ.window().onresize(function(){this._onWindowResize.notify()},this,aZ)}E.prototype={content:function(aZ){this._contentDom.content(aZ);this._onContentChanged.notify();return this},disableWindow:function(){aJ.window().disable();return this},enableWindow:function(){aJ.window().enable();return this},positionStrategy:function(aZ){return this.property("positionStrategy",aZ)},openSize:function(aZ){return this.property("openSize",aZ)},bounds:function(aZ){return this.property("bounds",aZ)},onOpen:function(a0,aZ,a1){this._onOpen.add(a0,aZ,a1);return this},onClose:function(a0,aZ,a1){this._onClose.add(a0,aZ,a1);return this},onCalibrate:function(a0,aZ,a1){this._onCalibrate.add(a0,aZ,a1);return this},onWindowResize:function(a0,aZ,a1){this._onWindowResize.add(a0,aZ,a1);return this},onContentChanged:function(a0,aZ,a1){this._onContentChanged.add(a0,aZ,a1);return this},removeListener:function(aZ){this._onOpen.remove(aZ);this._onClose.remove(aZ);this._onCalibrate.remove(aZ);this._onContentChanged.remove(aZ)},calibrate:function(){return this.pinTo(aK(this),function(){this._onCalibrate.notify()},this)},recalibrate:function(){this.clear().ease();var aZ=this.openSize()||this._contentDom.outerDims();return this.growTo(aZ,this.calibrate,this)},transition:function(aZ){this._contentDom.clear().fadeTo(0,function(){this.clear().ease().content(aZ);var a0=this.openSize()||this._contentDom.outerDims();this.growTo(a0,function(){this.pinTo(aK(this),function(){this._contentDom.fadeTo(100,function(){this.redraw()},this)},this)},this)},this);return this},open:function(a0){this.clear().to().fadeTo(100,function(){this._contentDom.fadeTo(0)},this).appendTo(this.bounds());this._onOpen.notify();var aZ=this;if(a0){setTimeout(function(){aQ(aZ)},a0)}else{aQ(aZ)}},close:function(){this._contentDom.ease().fadeTo(0,function(){this.ease().growTo(this._closeSize,function(){this.detach();this._onClose.notify()},this)},this);return this}};aJ.ext(E,aJ.sprite.Class);aJ.responsebox=function(){return new E()};function aK(a0){var a3=a0._positionStrategy().subtract(a0.outerDims().half()),a2=aJ.window().scrollOffset(),aZ=(a3.isLeftOf(a2))?a2.x():a3.x(),a1=(a3.isAbove(a2))?a2.y():a3.y();return aJ.coord(aZ,a1)}function aQ(a1){var a0=a1._contentDom,aZ=a1.openSize()||a0.outerDims();a1.growTo(aZ,function(){this.pinTo(aK(this),function(){a0.fadeTo(100)},a1)},a1)}function H(a0){R.base.call(this,a0);var aZ=aJ.create({div:{"class":"ku-scrubber-scrub"}}),a1=aJ.create({div:{"class":"ku-scrubber-scrubline"}});this._scrubber=aJ.sprite(aZ);this._scrubline=aJ.sprite(a1).appendChild(aZ).dragOff()}H.prototype={scrollPanel:function(aZ){return this.property("scrollPanel",aZ)},onScrub:function(a0,aZ,a1){this._scrubber.onDrag(a0,aZ,a1)}};aJ.ext(H,aJ.sprite.Class);aJ.scrubber=function(aZ){return new H(aZ)};function au(aZ){au.base.call(this,aZ);var a0=aJ.create({div:{}});this._content=aJ.sprite(a0).addClass("ku-scrollPanel-content").onGrab(function(){var a1=this._content;a1.dragOffset(a1.layoutDims())},this).onDrop(function(){var a1=this._content;this.scrollTo(a1.boundedOffset().add(a1.layoutDims()))},this);this.appendChild(a0).addClass("ku-scrollPanel").dragOff()}au.prototype={min:function(){return aJ.coord.zero()},max:function(){return this.get("max")},content:function(aZ){var a1,a0=this._content;if(aJ.isString(aZ)){a1=a0.html(aZ).pinTo(aJ.coord.zero())}else{a1=a0.clear().appendChild(aZ).pinTo(aJ.coord.zero())}this._max=aB(this);return a1},constrainX:function(){this._content.constrainX();return this},unconstrainX:function(){this._content.unconstrainX();return this},constrainY:function(){this._content.constrainY();return this},unconstrainY:function(){this._content.unconstrainY();return this},scrollTo:function(a3){if(!aJ.exists(a3)){return this}var a1=this.min(),a0=this.max()||a1,aZ=a3.x(),a2=a3.y();if(a3.isRightOf(a1)){aZ=a1.x()}if(a3.isLeftOf(a0)){aZ=a0.x()}if(a3.isBelow(a1)){a2=a1.y()}if(a3.isAbove(a0)){a2=a0.y()}this._content.to().pinTo(aJ.coord(aZ,a2));return this},scroller:function(aZ){this.set("scroller",aZ.scrollPanel(this))},displayScroller:function(){},hideScroller:function(){}};aJ.ext(au,aJ.sprite.Class);aJ.scrollPanel=function(aZ){return new au(aZ)};function aB(a3){var a2=a3._content.outerDims().subtract(a3.innerDims()),a0=aJ.coord.zero(),aZ=a2.isLeftOf(a0)?a0.x():a2.x(),a1=a2.isAbove(a0)?a0.y():a2.y();return a3.min().subtract(aJ.coord(aZ,a1))}})($);